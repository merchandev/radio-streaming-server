<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio En Vivo - Premium Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .player-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 450px;
            transition: all 0.3s ease;
        }

        .player-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
        }

        .status {
            text-align: center;
            margin-bottom: 25px;
            font-size: 14px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ccc;
            display: inline-block;
        }

        .status-dot.live {
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .status-dot.connecting {
            background: #ff9800;
            animation: pulse 1s infinite;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .play-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .play-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .play-button:active {
            transform: scale(0.95);
        }

        .play-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .volume-control {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-icon {
            font-size: 20px;
            color: #666;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .equalizer {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            height: 40px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .equalizer.active {
            opacity: 1;
        }

        .bar {
            width: 6px;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 3px;
            animation: bounce 0.8s ease-in-out infinite;
        }

        .bar:nth-child(1) {
            animation-delay: 0s;
        }

        .bar:nth-child(2) {
            animation-delay: 0.1s;
        }

        .bar:nth-child(3) {
            animation-delay: 0.2s;
        }

        .bar:nth-child(4) {
            animation-delay: 0.3s;
        }

        .bar:nth-child(5) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {

            0%,
            100% {
                height: 8px;
            }

            50% {
                height: 35px;
            }
        }

        .info-text {
            text-align: center;
            font-size: 12px;
            color: #999;
            margin-top: 15px;
        }
    </style>
</head>

<body>
    <div class="player-container">
        <h1>üéôÔ∏è Radio En Vivo</h1>

        <div class="status">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Listo para reproducir</span>
        </div>

        <div class="controls">
            <button class="play-button" id="playButton">
                <span id="playIcon">‚ñ∂</span>
                <span id="pauseIcon" style="display:none;">‚è∏</span>
                <span id="loadingIcon" style="display:none;">‚è≥</span>
            </button>

            <div class="volume-control">
                <span class="volume-icon">üîä</span>
                <input type="range" id="volumeSlider" min="0" max="100" value="80">
            </div>
        </div>

        <div class="equalizer" id="equalizer">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <div class="info-text">
            Click para empezar a escuchar
        </div>
    </div>

    <audio id="audioStream" preload="none" crossorigin="anonymous"></audio>

    <script>
        const audio = document.getElementById('audioStream');
        const playButton = document.getElementById('playButton');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const loadingIcon = document.getElementById('loadingIcon');
        const volumeSlider = document.getElementById('volumeSlider');
        const equalizer = document.getElementById('equalizer');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');

        let isPlaying = false;
        let reconnectAttempts = 0;
        const MAX_RECONNECT_ATTEMPTS = 10;
        const RECONNECT_DELAY = 5000; // 5 seconds

        // Stream URLs (fallback order)
        const STREAM_URLS = [
            '/radio.aac',
            '/stream.aac',
            '/stream'
        ];
        let currentUrlIndex = 0;

        // Set initial volume
        audio.volume = volumeSlider.value / 100;

        // Volume control
        volumeSlider.addEventListener('input', (e) => {
            audio.volume = e.target.value / 100;
        });

        // Update status
        function setStatus(state, message) {
            statusDot.className = 'status-dot ' + state;
            statusText.textContent = message;
        }

        // Set button icons
        function setButtonState(state) {
            playIcon.style.display = state === 'play' ? 'block' : 'none';
            pauseIcon.style.display = state === 'pause' ? 'block' : 'none';
            loadingIcon.style.display = state === 'loading' ? 'block' : 'none';
            playButton.disabled = state === 'loading';
        }

        // Load stream
        function loadStream() {
            const streamUrl = STREAM_URLS[currentUrlIndex];
            console.log(`Loading stream: ${streamUrl}`);
            audio.src = streamUrl;
            audio.load();
        }

        // Play stream
        async function playStream() {
            setStatus('connecting', 'Conectando...');
            setButtonState('loading');
            equalizer.classList.remove('active');

            loadStream();

            try {
                await audio.play();
                isPlaying = true;
                reconnectAttempts = 0;
                setStatus('live', 'Transmitiendo en vivo');
                setButtonState('pause');
                equalizer.classList.add('active');
                console.log('Stream playing successfully');
            } catch (error) {
                console.error('Play error:', error);
                isPlaying = false;
                setStatus('error', 'Error al reproducir');
                setButtonState('play');

                // Try next URL or reconnect
                if (currentUrlIndex < STREAM_URLS.length - 1) {
                    currentUrlIndex++;
                    console.log('Trying next stream URL...');
                    setTimeout(playStream, 1000);
                } else {
                    attemptReconnect();
                }
            }
        }

        // Stop stream
        function stopStream() {
            audio.pause();
            isPlaying = false;
            setStatus('', 'Detenido');
            setButtonState('play');
            equalizer.classList.remove('active');
            console.log('Stream stopped');
        }

        // Auto-reconnect
        function attemptReconnect() {
            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {
                setStatus('error', 'No se pudo conectar. Verifica Opticodec.');
                setButtonState('play');
                console.error('Max reconnect attempts reached');
                return;
            }

            reconnectAttempts++;
            setStatus('connecting', `Reintentando... (${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})`);

            console.log(`Reconnect attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS}`);

            setTimeout(() => {
                currentUrlIndex = 0; // Reset to first URL
                if (isPlaying) {
                    playStream();
                }
            }, RECONNECT_DELAY);
        }

        // Play button click
        playButton.addEventListener('click', () => {
            if (isPlaying) {
                stopStream();
            } else {
                playStream();
            }
        });

        // Audio event listeners
        audio.addEventListener('loadstart', () => {
            console.log('Stream loading...');
        });

        audio.addEventListener('canplay', () => {
            console.log('Stream ready');
        });

        audio.addEventListener('playing', () => {
            console.log('Stream is playing');
            setStatus('live', 'Transmitiendo en vivo');
            setButtonState('pause');
            equalizer.classList.add('active');
        });

        audio.addEventListener('error', (e) => {
            console.error('Stream error:', e);
            console.error('Error code:', audio.error?.code);
            console.error('Error message:', audio.error?.message);

            if (isPlaying) {
                attemptReconnect();
            } else {
                setStatus('error', 'Error al cargar');
                setButtonState('play');
            }
        });

        audio.addEventListener('stalled', () => {
            console.warn('Stream stalled');
            if (isPlaying) {
                setStatus('connecting', 'Reconectando...');
                attemptReconnect();
            }
        });

        audio.addEventListener('waiting', () => {
            console.log('Stream buffering...');
            setStatus('connecting', 'Buffering...');
        });

        // Log ready
        console.log('Radio player initialized');
        console.log('Stream URLs:', STREAM_URLS);
    </script>
</body>

</html>