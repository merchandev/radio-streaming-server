FROM moul/icecast

# Install curl for healthchecks using apt-get (Debian-based)
RUN apt-get update && \
    apt-get install -y curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Copy optimized configuration
COPY config/icecast.xml /etc/icecast.xml

# Expose both ports
EXPOSE 8080 8000

# Healthcheck
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:8080/status.xsl || exit 1
